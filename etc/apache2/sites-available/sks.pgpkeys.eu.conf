<VirtualHost *:80>
	ServerName sks.pgpkeys.eu
	ServerAdmin #REDACTED#
	DocumentRoot /var/www/pgpkeyserver-lite

	ErrorLog ${APACHE_LOG_DIR}/sks.pgpkeys.eu-error.log
	CustomLog ${APACHE_LOG_DIR}/sks.pgpkeys.eu-access.log combined

        # Reverse proxy for SKS WS:ABG 20150812
        RewriteEngine on
        RewriteRule ^/stats http://127.0.0.1:21371/pks/lookup?op=stats [P]
        RewriteRule ^/s/(.*) http://127.0.0.1:21371/pks/lookup?search=$1 [P]
        RewriteRule ^/search/(.*) http://127.0.0.1:21371/pks/lookup?search=$1 [P]
        RewriteRule ^/g/(.*) http://127.0.0.1:21371/pks/lookup?op=get&search=$1 [P]
        RewriteRule ^/get/(.*) http://127.0.0.1:21371/pks/lookup?op=get&search=$1 [P]
        RewriteRule ^/d/(.*) http://127.0.0.1:21371/pks/lookup?op=get&options=mr&search=$1 [P]
        RewriteRule ^/download/(.*) http://127.0.0.1:21371/pks/lookup?op=get&options=mr&search=$1 [P]
        RewriteRule ^/pks/(.*) http://127.0.0.1:21371/pks/$1 [P]

        # Need this to be recognised as a reverse proxy by the sks pool
        #ProxyVia On
</VirtualHost>

<VirtualHost *:11371>
	ServerName sks.pgpkeys.eu
	ServerAdmin #REDACTED#
	DocumentRoot /var/www/pgpkeyserver-lite

	ErrorLog ${APACHE_LOG_DIR}/sks.pgpkeys.eu.hkp-error.log
	CustomLog ${APACHE_LOG_DIR}/sks.pgpkeys.eu.hkp-access.log combined

        # Reverse proxy for SKS WS:ABG 20150812
        RewriteEngine on
        RewriteRule ^/stats http://127.0.0.1:11371/pks/lookup?op=stats [P]
        RewriteRule ^/s/(.*) http://127.0.0.1:11371/pks/lookup?search=$1 [P]
        RewriteRule ^/search/(.*) http://127.0.0.1:11371/pks/lookup?search=$1 [P]
        RewriteRule ^/g/(.*) http://127.0.0.1:11371/pks/lookup?op=get&search=$1 [P]
        RewriteRule ^/get/(.*) http://127.0.0.1:11371/pks/lookup?op=get&search=$1 [P]
        RewriteRule ^/d/(.*) http://127.0.0.1:11371/pks/lookup?op=get&options=mr&search=$1 [P]
        RewriteRule ^/download/(.*) http://127.0.0.1:11371/pks/lookup?op=get&options=mr&search=$1 [P]
        RewriteRule ^/pks/(.*) http://127.0.0.1:11371/pks/$1 [P]

        # Need this to be recognised as a reverse proxy by the sks pool
        #ProxyVia On
</VirtualHost>

<VirtualHost *:443>
	ServerName sks.pgpkeys.eu
	ServerAdmin #REDACTED#
	DocumentRoot /var/www/pgpkeyserver-lite

	ErrorLog ${APACHE_LOG_DIR}/sks.pgpkeys.eu.ssl-error.log
	CustomLog ${APACHE_LOG_DIR}/sks.pgpkeys.eu.ssl-access.log combined

	SSLEngine on
	SSLStrictSNIVHostCheck off
	SSLCertificateFile /etc/letsencrypt/live/sks.pgpkeys.eu/fullchain.pem
	SSLCertificateKeyFile /etc/letsencrypt/live/sks.pgpkeys.eu/privkey.pem
	SSLCACertificateFile /etc/letsencrypt/live/sks.pgpkeys.eu/chain.pem

	<Directory /var/www/html>
		Options -Indexes
		AllowOverride None
		Require all granted
	</Directory>

        # Reverse proxy for SKS WS:ABG 20150812
        RewriteEngine on
        RewriteRule ^/stats http://127.0.0.1:22371/pks/lookup?op=stats [P]
        RewriteRule ^/s/(.*) http://127.0.0.1:22371/pks/lookup?search=$1 [P]
        RewriteRule ^/search/(.*) http://127.0.0.1:22371/pks/lookup?search=$1 [P]
        RewriteRule ^/g/(.*) http://127.0.0.1:22371/pks/lookup?op=get&search=$1 [P]
        RewriteRule ^/get/(.*) http://127.0.0.1:22371/pks/lookup?op=get&search=$1 [P]
        RewriteRule ^/d/(.*) http://127.0.0.1:22371/pks/lookup?op=get&options=mr&search=$1 [P]
        RewriteRule ^/download/(.*) http://127.0.0.1:22371/pks/lookup?op=get&options=mr&search=$1 [P]
        RewriteRule ^/pks/(.*) http://127.0.0.1:22371/pks/$1 [P]

        # Need this to be recognised as a reverse proxy by the sks pool
        #ProxyVia On
</VirtualHost>
